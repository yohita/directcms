import{defineOperationApp as e}from"@directus/extensions-sdk";import{defineComponent as t,ref as i,computed as a,unref as o,watch as n,resolveComponent as l,openBlock as d,createBlock as s}from"vue";function r(){return function(e){const t=e.split("/"),i=t.indexOf("admin");return t.slice(0,i).join("/")+"/"}(window.location.href)}var m=e({id:"liquidjs-operation",name:"Liquid Template",icon:"water_drop",description:"Render dynamic content using Liquid templates.",overview:({text:e})=>[{label:"Text",text:e}],options:((e,t)=>{const i=e.__vccOpts||e;for(const[e,a]of t)i[e]=a;return i})(t({__name:"options",props:{value:{default:()=>({mode:"custom",operationMode:"single",data:{}})}},emits:["input"],setup(e,{emit:t}){const m=e,c=t,u=i({...m.value,publicUrl:r()}),p=a((()=>o(u).mode||"custom")),f=a((()=>o(u).operationMode||"single")),h=a((()=>o(u).collection||"")),v=[{field:"mode",name:"Template Mode",type:"string",meta:{width:"half",note:"Choose how to provide the Liquid template. Custom Template: write inline. Saved Template: use a template stored in a collection.",interface:"select-dropdown",options:{choices:[{text:"Custom Template",value:"custom"},{text:"Saved Template",value:"saved"}]}}},{field:"operationMode",name:"Operation Mode",type:"string",meta:{width:"half",note:"Choose processing mode. Single: render one template with one data object. Batch: render the template multiple times, once for each item in an array of data objects.",interface:"select-dropdown",options:{choices:[{text:"Single",value:"single"},{text:"Batch",value:"batch"}]}}},{field:"publicUrl",name:"PublicUrl",type:"string",meta:{interface:"input",hidden:!0,readonly:!0}}],g=a((()=>[{field:"template",name:"Template",type:"text",meta:{width:"full",interface:"input-code",hidden:"custom"!==p.value,note:"Enter your Liquid template here. Use {# #} for output tags instead of {{ }}. All other Liquid tags remain unchanged. Example: `Hello, {# user.name #}! {% if user.admin %}Admin area{% endif %}`",options:{language:"htmlmixed",template:"Hello, {# first_name #}! {% if is_admin %}Welcome to the Admin.{% endif %}",placeholder:"Hello, {# first_name #}! {% if is_admin %}Welcome to the Admin.{% endif %}"}}},{field:"collection",name:"Collection",type:"string",meta:{width:"half",note:"Select the collection containing your saved Liquid templates.",interface:"system-collection",hidden:"saved"!==p.value}},{field:"item",name:"Item",type:"string",meta:{width:"half",note:"Choose the specific template to render from the selected collection.",interface:"collection-item-dropdown",options:{selectedCollection:h.value,template:"{{subject}}",valueField:"id"},hidden:"saved"!==p.value||!h.value}},{field:"fields",name:"Fields",type:"json",meta:{width:"half",note:"Choose fields to process and render. Only selected fields appear in output. Ideal for email scenarios with dynamic subject and body.",interface:"system-field-tree",options:{collectionName:h.value},hidden:"saved"!==p.value||!h.value}},{field:"accessToken",name:"Access Token",type:"string",meta:{width:"half",interface:"input",note:"Required for accessing private template collections in `Saved Template` mode. Alternatively, make your template collection public. Ensure the token has read permissions for the template collection.",hidden:"saved"!==p.value,options:{masked:!0}}},{field:"data",name:"Data",type:"json",meta:{required:!0,width:"full",note:'JSON data to populate the template. Format: object for single mode, array of objects for batch mode. Supports mustache syntax for dynamic values, e.g., {"user": "{{$trigger.user}}"}.',interface:"input-code",options:{language:"json",template:'{"first_name":"John","last_name":"Doe","is_admin":true}',placeholder:'{"first_name":"John","last_name":"Doe","is_admin":true}'}}},{field:"dataReturnFields",name:"Return Fields from Data",type:"json",meta:{width:"full",interface:"tags",note:'Specify fields from your input data to include in each output object. Useful for maintaining context or identification (e.g., "id", "name"). These fields will be added alongside the output for each item in batch mode.',hidden:"batch"!==f.value,options:{placeholder:"Add a field key and press Enter..."}}}])),y=a((()=>[...v,...g.value]));return n(u,(e=>{c("input",e)}),{deep:!0}),n((()=>m.value),(e=>{null!==e&&JSON.stringify(e)!==JSON.stringify(u.value)&&(u.value={...e,publicUrl:r()})}),{deep:!0}),(e,t)=>{const i=l("v-form");return d(),s(i,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),fields:y.value,"primary-key":"+"},null,8,["modelValue","fields"])}}}),[["__file","options.vue"]])});export{m as default};
